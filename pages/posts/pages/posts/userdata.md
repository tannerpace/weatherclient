---
title: Automating Spring Boot Deployment on EC2 with MySQL
date: 2022/6/12
description: A step-by-step guide to automate Spring Boot and MySQL setup on EC2 using bash scripts
tags: [spring-boot, ec2, aws, mysql]
author: Tanner Bleakley
---

## Automating Spring Boot Application Deployment with MySQL on Amazon Linux

Deploying a Spring Boot application on an Amazon Linux EC2 instance can be a straightforward task, but adding automated MySQL setup, secure GitHub repository access, and systemd service management can take your setup to the next level. In this blog post, I’ll walk you through a bash script that automates the entire process—from installing necessary packages to setting up your application as a service.

### Overview

This script accomplishes the following tasks:

1. **Updates the system and installs required packages**: Java 17, Git, Maven, and MySQL.
2. **Sets up MySQL**: Installs MySQL, creates a database, and configures a user with the necessary privileges.
3. **Clones your Spring Boot application from GitHub**: Securely clones the repository using a GitHub token.
4. **Builds and packages the Spring Boot application**: Uses Maven to package your application.
5. **Creates and configures a systemd service**: Ensures your application starts on boot and can be managed like any other service.
6. **Deploys the application and sets up a deploy script**: A simple script is created to allow easy redeployment of updated code.

### The Script

Here’s the bash script that automates the entire setup:

```bash
#!/bin/bash

# Update the package repository and install necessary packages
sudo yum update -y
sudo yum install -y java-17 git maven

# Set variables
APP_DIR="/opt/my-spring-boot-app"
GITHUB_TOKEN="your-github-token-here"  # Set your GitHub token here
REPO_URL="https://$GITHUB_TOKEN@github.com/<USER_NAME>/api.git"
SERVICE_NAME="my-spring-boot-app"
JAR_NAME="app-0.0.1-SNAPSHOT.jar"
SUBDIR="app"  # Subdirectory where the pom.xml is located
DB_NAME="myappdb"
DB_USER="myappuser"
DB_PASSWORD="mypassword"

# Install MySQL from the official MySQL repository
sudo yum install -y https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
sudo yum install -y mysql-community-server

# Start MySQL service and enable it to start on boot
sudo systemctl start mysqld
sudo systemctl enable mysqld

# Get the temporary root password generated by MySQL
TEMP_PASSWORD=$(sudo grep 'temporary password' /var/log/mysqld.log | awk '{print $NF}')

# Run the MySQL secure installation with the temporary password
sudo mysql --connect-expired-password -uroot -p"$TEMP_PASSWORD" <<EOF
ALTER USER 'root'@'localhost' IDENTIFIED BY '$DB_PASSWORD';
UNINSTALL COMPONENT 'file://component_validate_password';
ALTER USER 'root'@'localhost' IDENTIFIED WITH 'mysql_native_password' BY '$DB_PASSWORD';
CREATE DATABASE $DB_NAME;
CREATE USER '$DB_USER'@'localhost' IDENTIFIED BY '$DB_PASSWORD';
GRANT ALL PRIVILEGES ON $DB_NAME.* TO '$DB_USER'@'localhost';
FLUSH PRIVILEGES;
EXIT;
EOF

# Create the application directory if it doesn't exist
if [ ! -d "$APP_DIR" ]; then
  sudo mkdir -p $APP_DIR
fi

# Clone the repository if it doesn't already exist
if [ ! -d "$APP_DIR/.git" ]; then
  sudo git clone $REPO_URL $APP_DIR
fi

# Navigate to the application directory
cd $APP_DIR

# Pull the latest changes
sudo git pull origin main

# Navigate to the subdirectory where the pom.xml is located
cd $SUBDIR

# Build the application
sudo mvn clean package

# Create a systemd service file
sudo bash -c "cat > /etc/systemd/system/$SERVICE_NAME.service <<EOF
[Unit]
Description=Spring Boot Application
After=network.target

[Service]
User=ec2-user
WorkingDirectory=$APP_DIR/$SUBDIR
ExecStart=/usr/bin/java -jar $APP_DIR/$SUBDIR/target/$JAR_NAME
SuccessExitStatus=143
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF"

# Reload systemd to recognize the new service
sudo systemctl daemon-reload

# Enable the service to start on boot
sudo systemctl enable $SERVICE_NAME

# Start the Spring Boot service
sudo systemctl start $SERVICE_NAME

# Set up the deployment script
sudo bash -c "cat > /usr/local/bin/deploy.sh <<EOF
#!/bin/bash
cd $APP_DIR/$SUBDIR
sudo git pull origin main
sudo mvn clean package
sudo systemctl restart $SERVICE_NAME
EOF"

# Make the deployment script executable
sudo chmod +x /usr/local/bin/deploy.sh

# Reboot the system to ensure everything is set up correctly
sudo reboot
```
